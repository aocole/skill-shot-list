<style>
#railsmain {
  color: black;
  background-color: white;
  padding: 10px;
}

.axis path,
.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1px;
}
</style>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
  var dataset = <%= @machines_over_time.collect{|pair|pair[0] = pair[0].to_i * 1000; pair}.to_json.html_safe %>

  w = 800
  h = 500
  padding = 30

  var scaleX = d3.time.scale()
            .range([padding, w-padding])
            .domain(d3.extent(dataset, function(d){return new Date(d[0])}));
  var scaleY = d3.scale.linear()
            .range([padding, h-padding])
            .domain([
              d3.max(dataset, function(d){return d[1]}),
              80//d3.min(dataset, function(d){return d[1]}) 
            ]);
  var svg = d3.select("#railsmain")
              .append("svg")
            .attr("width", w)
              .attr("height", h);

  // svg.selectAll("circle")
  //    .data(dataset)
  //    .enter()
  //    .append("circle")
  //    .attr("fill", "black")   
  //    .attr("cx", function(d) {
  //         return scaleX(new Date(d[0]));
  //    })
  //    .attr("cy", function(d) {
  //         return scaleY(d[1]);
  //    })
  //    .attr("r", 1);

  var line = d3.svg.line()
    .x(function(d) { return scaleX(new Date(d[0])) })
    .y(function(d) { return scaleY(d[1]) });

  svg.append("path")
      .datum(dataset)
      .attr("class", "line")
      .attr("d", line);

  var xAxis = d3.svg.axis().scale(scaleX).orient("bottom");
  svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + (h - padding) + ")")
    .call(xAxis);

  var yAxis = d3.svg.axis()
                  .scale(scaleY)
                  .orient("left")
                  .ticks(20);

  svg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(" + padding + ",0)")
      .call(yAxis);
</script>

<!-- <h1>Oldest machines on location</h1>
<ol>
<%if false # @oldest_machines.each do |machine| %>
  <li><%=machine.title.name%> at <em><%=machine.location.name%></em>, since <%=machine.created_at.strftime("%b %d, %Y")%></li>
<% end %>
</ol>
 -->
